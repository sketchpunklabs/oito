<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><title></title></head>
<style>canvas{ display:block; } body, html { padding:0px; margin:0px; width:100%; height:100%; }</style>
<body><script type="module">
//#region IMPORTS
import useThreeWebGL2, { useDarkScene, useVisualDebug } from '../_lib/useThreeWebGL2.js';
import facedCube   from '../_lib/meshes/facedCube.js';

import { Vec3, Quat }  from '@oito/oop';
import { Frustum }     from '@oito/ray';
//#endregion

//#region MAIN
let App   = useDarkScene( useThreeWebGL2() );
let Debug = {};
let Ref   = {};

window.addEventListener( 'load', async _=>{
    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // Setup
    App.sphericalLook( 0, 20, 10 );
    Debug = await useVisualDebug( App );

    // App.scene.add( ( Ref.cube  = facedCube() ) );


    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    // Debug.pnt.add( [0,1,0], 0x00ff00, 7, 6 );
    // Debug.ln.add( [0,1,0], [0,2,0], 0x00ff00, 0x00ffff );

    const f = new Frustum()
        .setCamera( 45, 0.5, 5, 1.0 )
        .setPos( [0,1,0 ] )
        .setRot( Quat.LOOKXP )
        .update();

    renderFrustum( f );
    
    // ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    App.renderLoop();
    // App.createRenderLoop( onPreRender ).start();
});

// function onPreRender( dt, et ){}
//#endregion


function renderFrustum( f, showPlanes=true ){
    Debug.reset();

    const col = 0x00ffff;

    for( let i=0; i < 4; i++ ){
        const ii = (i+1) % 4;
        Debug.ln.add( f.nearPoints[ i ], f.farPoints[ i ], col );
        Debug.ln.add( f.nearPoints[ i ], f.nearPoints[ ii ], col );
        Debug.ln.add( f.farPoints[ i ], f.farPoints[ ii ], col );
        Debug.ln.add( f.nearPoints[ i ], f.pos, col );
    }

    if( showPlanes ){
        const v = new Vec3();
        for( let i=0; i < 6; i++ ){
            v.fromScaleThenAdd( 0.4, f.planes[i].norm, f.planes[i].pos );
            Debug.ln.add( f.planes[i].pos, v, col );
        }
    }
}

</script></body></html>